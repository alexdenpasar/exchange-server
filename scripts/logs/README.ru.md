# Exchange Log Cleanup Script

**–Ø–∑—ã–∫–∏ / Languages:**
- [üá∑üá∫ –†—É—Å—Å–∫–∏–π](README.ru.md) ‚Üê (–¢–µ–∫—É—â–∏–π)
- [üá∫üá∏ English](README.md)

PowerShell —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π Exchange Server —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö.

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π Exchange Server. –û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∂–¥–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö.

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** —Å–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- –°–∫—Ä–∏–ø—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- –õ–æ–≥–∏ —É–¥–∞–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "Clean Shutdown"
- –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–≥–æ–≤ –ø—Ä–∏ Dirty Shutdown
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—É—Ç–µ–π –∫ –ª–æ–≥–∞–º
- ‚úÖ –¶–≤–µ—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—Ä–æ–≤–Ω—è–º–∏ –≤–∞–∂–Ω–æ—Å—Ç–∏

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ –ø–∞–ø–∫—É:
   ```
   C:\Scripts\Maintenance\ExchangeLogCleanup.ps1
   ```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞:
   ```powershell
   $LogRetentionDays = 7  # –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ (–≤ –¥–Ω—è—Ö)
   ```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- **`$LogRetentionDays`** - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 7)
- **`$CurrentServer`** - –ò–º—è —Ç–µ–∫—É—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è)
- **`$ScriptPath`** - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–∫—Ä–∏–ø—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è)
- **`$LogFile`** - –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ —Å–∫—Ä–∏–ø—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```powershell
# –ó–∞–ø—É—Å–∫ –∏–∑ Exchange Management Shell
.\ExchangeLogCleanup.ps1
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```powershell
# –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –≤ —Å–∫—Ä–∏–ø—Ç–µ:
$LogRetentionDays = 14  # –•—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ 14 –¥–Ω–µ–π
```

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Task Scheduler

```powershell
# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
$Action = New-ScheduledTaskAction -Execute "PowerShell.exe" -Argument "-ExecutionPolicy Bypass -File C:\Scripts\Maintenance\ExchangeLogCleanup.ps1"
$Trigger = New-ScheduledTaskTrigger -Weekly -DaysOfWeek Sunday -At 3:00AM
$Settings = New-ScheduledTaskSettingsSet -RunOnlyIfNetworkAvailable -WakeToRun
Register-ScheduledTask -TaskName "Exchange Log Cleanup" -Action $Action -Trigger $Trigger -Settings $Settings -User "DOMAIN\ExchangeAdmin"
```

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ª–æ–≥–æ–≤ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ Exchange
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

### 2. –î–ª—è –∫–∞–∂–¥–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
1. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   ```powershell
   Dismount-Database -Identity $DB -Confirm:$false
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   ```powershell
   eseutil /mh $DBPath  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Clean Shutdown
   ```

3. **–£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤** (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ Clean Shutdown)
   ```powershell
   Get-ChildItem -Path $LogPath -Filter "*.log" | 
   Where-Object { $_.LastWriteTime -lt (Get-Date).AddDays(-$LogRetentionDays) } | 
   Remove-Item -Force
   ```

4. **–í–∫–ª—é—á–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   ```powershell
   Mount-Database -Identity $DB
   ```

### 3. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

–§–∞–π–ª –ª–æ–≥–æ–≤ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ø–∞–ø–∫–µ —Å–∫—Ä–∏–ø—Ç–∞ —Å –∏–º–µ–Ω–µ–º:
```
ExchangeCleanup_YYYY-MM-DD_HH-MM-SS.log
```

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞

```
2024-01-15 03:00:00 [INFO] === –ó–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤ Exchange –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ EXCH01 ===
2024-01-15 03:00:01 [INFO] –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –±–∞–∑—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ EXCH01 : DB01, DB02, DB03
2024-01-15 03:00:02 [INFO] 
–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞–∑—ã: DB01
2024-01-15 03:00:03 [INFO] –û—Ç–∫–ª—é—á–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: DB01
2024-01-15 03:00:08 [INFO] –ë–∞–∑–∞ DB01 —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ...
2024-01-15 03:00:09 [INFO] –ë–∞–∑–∞ DB01 –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Clean Shutdown. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏...
2024-01-15 03:00:10 [INFO] –£–¥–∞–ª–µ–Ω–æ 25 –ª–æ–≥–æ–≤ –≤ –ø–∞–ø–∫–µ D:\Logs\DB01
2024-01-15 03:00:11 [INFO] –ó–∞–ø—É—Å–∫–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: DB01
2024-01-15 03:00:16 [INFO] –ë–∞–∑–∞ DB01 —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞.
```

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

- **INFO** - –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç (–æ–±—ã—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
- **WARNING** - –ñ–µ–ª—Ç—ã–π —Ç–µ–∫—Å—Ç (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)
- **ERROR** - –ö—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç (–æ—à–∏–±–∫–∏)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### Clean Shutdown vs Dirty Shutdown

**Clean Shutdown:**
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞
- –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
- –õ–æ–≥–∏ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª—è—Ç—å

**Dirty Shutdown:**
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í–æ–∑–º–æ–∂–Ω—ã –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –õ–æ–≥–∏ –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è (–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è)

### –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

```cmd
eseutil /mh "D:\Database\DB01.edb"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Clean Shutdown:**
```
State: Clean Shutdown
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Dirty Shutdown:**
```
State: Dirty Shutdown
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–∫—Ä–∏–ø—Ç –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ Dismount-Database

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
Get-StoreUsageStatistics -Database "DB01" | Where-Object {$_.TimeInServer -gt 0}

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
Dismount-Database -Identity "DB01" -Confirm:$false -Force
```

### Dirty Shutdown –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë–∞–∑–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Dirty Shutdown –ø–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
- –õ–æ–≥–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –±–∞–∑—ã
eseutil /mh "D:\Database\DB01.edb"

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ª–æ–≥–æ–≤ (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
eseutil /r E00 /l "D:\Logs\DB01"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
eseutil /mh "D:\Database\DB01.edb"
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑—ã
- –ë–∞–∑–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Dismounted

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö —Å–æ–±—ã—Ç–∏–π
Get-EventLog -LogName Application -Source "MSExchange*" -Newest 10

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
eseutil /mh "D:\Database\DB01.edb"

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
Mount-Database -Identity "DB01" -Force
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏

1. **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   ```powershell
   $LogRetentionDays = 7
   # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 3:00
   ```

2. **–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞**
   ```powershell
   $LogRetentionDays = 30
   # –ó–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞
   ```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–æ –∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏
Get-WmiObject -Class Win32_LogicalDisk | 
Select-Object DeviceID, @{Name="FreeSpace(GB)";Expression={[math]::Round($_.FreeSpace/1GB,2)}}
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```powershell
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –ª–æ–≥–æ–≤ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
$BackupPath = "\\BackupServer\Exchange\Logs\$(Get-Date -Format 'yyyyMMdd')"
New-Item -ItemType Directory -Path $BackupPath -Force
Copy-Item -Path "D:\Logs\*" -Destination $BackupPath -Recurse
```

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```powershell
# –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
if ($ErrorCount -gt 0) {
    Send-MailMessage -To "admin@company.com" -Subject "Exchange Log Cleanup - Errors" -Body "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ª–æ–≥–æ–≤"
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤

```powershell
# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—á–∏—Å—Ç–∫–∏
$LogPath = "C:\Scripts\Maintenance"
$CleanupLogs = Get-ChildItem $LogPath -Filter "ExchangeCleanup_*.log"

foreach ($Log in $CleanupLogs) {
    $Content = Get-Content $Log.FullName
    $DeletedCount = ($Content | Select-String "–£–¥–∞–ª–µ–Ω–æ \d+ –ª–æ–≥–æ–≤").Matches.Count
    $ErrorCount = ($Content | Select-String "\[ERROR\]").Count
    
    Write-Host "–õ–æ–≥: $($Log.Name), –£–¥–∞–ª–µ–Ω–æ: $DeletedCount, –û—à–∏–±–æ–∫: $ErrorCount"
}
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Exchange Server 2016/2019
- PowerShell 5.0 –∏–ª–∏ –≤—ã—à–µ
- –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Exchange
- –ü—Ä–∞–≤–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ Exchange Server 2016
- ‚úÖ Exchange Server 2019
- ‚úÖ Windows Server 2012 R2 / 2016 / 2019
- ‚ö†Ô∏è Exchange Server 2013 (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚ùå Exchange Online (–Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞—É–¥–∏—Ç–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö –ª–æ–≥–æ–≤

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –ª–æ–≥–æ–≤ —Å–∫—Ä–∏–ø—Ç–∞
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Event Viewer –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Exchange
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Exchange Management Console
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Microsoft Exchange

## –õ–∏—Ü–µ–Ω–∑–∏—è

–°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è "–∫–∞–∫ –µ—Å—Ç—å" –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.