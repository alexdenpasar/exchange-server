# Exchange 2016 Migration Scripts

## –Ø–∑—ã–∫–∏ / Languages
- [üá∑üá∫ –†—É—Å—Å–∫–∏–π](README.ru.md) ‚Üê (–¢–µ–∫—É—â–∏–π)
- [üá∫üá∏ English](README.md)

–ù–∞–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö PowerShell —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤ Exchange Server 2016 —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏.

## –°–æ—Å—Ç–∞–≤ –ø–∞–∫–µ—Ç–∞

### –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏

1. **`Email_PrimaryOnly_Migrations.ps1`** - –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤
2. **`Email_ArchiveOnly_Migrations.ps1`** - –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –∞—Ä—Ö–∏–≤–æ–≤
3. **`Migration_Monitor.ps1`** - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

4. **`EmailList.txt`** - –°–ø–∏—Å–æ–∫ email-–∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ –¶–≤–µ—Ç–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

### –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
C:\Scripts\Migration\
‚îú‚îÄ‚îÄ Email_PrimaryOnly_Migrations.ps1
‚îú‚îÄ‚îÄ Email_ArchiveOnly_Migrations.ps1
‚îú‚îÄ‚îÄ Migration_Monitor.ps1
‚îú‚îÄ‚îÄ EmailList.txt
‚îî‚îÄ‚îÄ Logs\
    ‚îú‚îÄ‚îÄ MailboxMigration_YYYYMMDD_HHMMSS.log
    ‚îî‚îÄ‚îÄ MailboxMigration_OnlyArchive_YYYYMMDD_HHMMSS.log
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–∞–∂–¥–æ–º —Å–∫—Ä–∏–ø—Ç–µ:

```powershell
# –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
$TargetDatabase = "DB-Archive"            # –¶–µ–ª–µ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
$DomainController = "dc.example.com"      # –î–æ–º–µ–Ω-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
$EmailListFile = "C:\Scripts\Migration\EmailList.txt"  # –§–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º email
$MaxParallelMoves = 3                     # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
$BadItemLimit = 100                       # –õ–∏–º–∏—Ç –ø–ª–æ—Ö–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
$CheckInterval = 60                       # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Å–µ–∫—É–Ω–¥—ã)
```

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ email

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `EmailList.txt` —Å email-–∞–¥—Ä–µ—Å–∞–º–∏:

```
user1@example.com
user2@example.com
user3@example.com
# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #
# user4@example.com - –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤

```powershell
# –ó–∞–ø—É—Å–∫ –∏–∑ Exchange Management Shell
.\Email_PrimaryOnly_Migrations.ps1
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—á—Ç–æ–≤—ã–µ —è—â–∏–∫–∏ (–±–µ–∑ –∞—Ä—Ö–∏–≤–æ–≤)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `-PrimaryOnly`
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —è—â–∏–∫–æ–≤
- –ú–∞–∫—Å–∏–º—É–º 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –∞—Ä—Ö–∏–≤–æ–≤

```powershell
# –ó–∞–ø—É—Å–∫ –∏–∑ Exchange Management Shell
.\Email_ArchiveOnly_Migrations.ps1
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞—Ä—Ö–∏–≤—ã –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `-ArchiveOnly`
- –ú–µ–Ω—å—à–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–∞–∫—Å–∏–º—É–º 1 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∏–≥—Ä–∞—Ü–∏–π

```powershell
# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
.\Migration_Monitor.ps1
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
- –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- –¶–≤–µ—Ç–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ Ctrl+C

## –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏

–°–∫—Ä–∏–ø—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è –º–∏–≥—Ä–∞—Ü–∏–π:

```powershell
# –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç, –æ–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
while ($InProgress.Count -ge $MaxParallelMoves) {
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
    # –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∏–∑ –æ—á–µ—Ä–µ–¥–∏
    # –û–∂–∏–¥–∞–Ω–∏–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Å–ª–æ—Ç–∞
}
```

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–≤–∏—Å—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π:

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
if (((Get-Date) - $InProgress[$ActiveEmail]).TotalHours -gt 24) {
    # –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–≤–∏—Å–∞–Ω–∏—è
    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:

```
2024-01-15 10:30:00 - –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤ –∑–∞–ø—É—â–µ–Ω
2024-01-15 10:30:01 - –¶–µ–ª–µ–≤–∞—è –ë–î: DB-Archive, –ú–∞–∫—Å. –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π: 3
2024-01-15 10:30:02 - –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ email-–∞–¥—Ä–µ—Å–æ–≤: 50
2024-01-15 10:30:03 - –ù–∞—á–∞–ª–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—á—Ç–æ–≤–æ–≥–æ —è—â–∏–∫–∞ user1@example.com
2024-01-15 10:30:04 - –ó–∞–ø—Ä–æ—Å –Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—é —Å–æ–∑–¥–∞–Ω –¥–ª—è user1@example.com
2024-01-15 11:45:30 - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è user1@example.com –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (–°—Ç–∞—Ç—É—Å: Completed, –ü—Ä–æ—Ü–µ–Ω—Ç: 100%)
```

## –ò–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ –º–æ–Ω–∏—Ç–æ—Ä–µ

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

- üü¢ **–ó–µ–ª–µ–Ω—ã–π** - –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
  - `Completed`, `CopyingMessages`, `ScanningForMessages`
- üü° **–ñ–µ–ª—Ç—ã–π** - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
  - `InProgress`, `StalledDueToMail_*`, `Suspended`
- üî¥ **–ö—Ä–∞—Å–Ω—ã–π** - –û—à–∏–±–∫–∏
  - `Failed`, `StalledDueToSource_*`, `StalledDueToTarget_*`
- üîµ **–°–∏–Ω–∏–π** - –û–∂–∏–¥–∞–Ω–∏–µ
  - `Queued`, `WaitingForJobPickup`

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: John Doe (john.doe@example.com)
–°—Ç–∞—Ç—É—Å: InProgress
–î–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å: CopyingMessages
–ü—Ä–æ–≥—Ä–µ—Å—Å: 75%
–ò—Å—Ç–æ—á–Ω–∏–∫: DB-Old
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: DB-Archive
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ó–∞–≤–∏—Å—à–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–æ–ª–µ–µ 24 —á–∞—Å–æ–≤
- –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –°—Ç–∞—Ç—É—Å `StalledDueToSource_*` –∏–ª–∏ `StalledDueToTarget_*`

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
Get-MoveRequestStatistics -Identity "user@example.com" -IncludeReport

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–≤–∏—Å—à–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
Remove-MoveRequest -Identity "user@example.com" -Confirm:$false
New-MoveRequest -Identity "user@example.com" -TargetDatabase "DB-Archive"
```

### –û—à–∏–±–∫–∏ "BadItemLimit"

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞
- –í –ª–æ–≥–∞—Ö —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –≤ —Å–∫—Ä–∏–ø—Ç–µ
$BadItemLimit = 500

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AcceptLargeDataLoss
New-MoveRequest -Identity "user@example.com" -TargetDatabase "DB-Archive" -BadItemLimit 1000 -AcceptLargeDataLoss
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –£–º–µ–Ω—å—à–∏—Ç–µ `$MaxParallelMoves` –¥–ª—è –±–æ–ª—å—à–∏—Ö —è—â–∏–∫–æ–≤
- –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤ –∏ —Å–µ—Ç–∏

```powershell
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
$MaxParallelMoves = 1
$CheckInterval = 120  # –£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**
   ```powershell
   # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
   Get-Mailbox -Database "SourceDB" | New-MailboxExportRequest -FilePath "\\BackupServer\{0}.pst"
   
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç —Ü–µ–ª–µ–≤–æ–π –ë–î
   Get-MailboxDatabase "TargetDB" | fl ProhibitSendQuota,ProhibitSendReceiveQuota
   ```

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   ```powershell
   # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞
   .\ExchangeDefrag.ps1 -DatabaseName "SourceDB"
   
   # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   Get-Counter "\MSExchange Database(*)\Database Page Fault Stalls/sec"
   ```

### –ü–∞–∫–µ—Ç–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

```powershell
# –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ –≥—Ä—É–ø–ø–∞–º
$Groups = @("Sales", "Marketing", "IT")
foreach ($Group in $Groups) {
    Get-ADGroupMember $Group | ForEach-Object { $_.Mail } | Out-File "EmailList_$Group.txt"
    .\Email_PrimaryOnly_Migrations.ps1 -EmailListFile "EmailList_$Group.txt"
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Task Scheduler

```powershell
# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –Ω–æ—á–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
$Action = New-ScheduledTaskAction -Execute "PowerShell.exe" -Argument "-ExecutionPolicy Bypass -File C:\Scripts\Migration\Email_PrimaryOnly_Migrations.ps1"
$Trigger = New-ScheduledTaskTrigger -Daily -At 2:00AM
$Settings = New-ScheduledTaskSettingsSet -RunOnlyIfNetworkAvailable
Register-ScheduledTask -TaskName "Exchange Migration" -Action $Action -Trigger $Trigger -Settings $Settings
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

```powershell
# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π
$LogPath = "C:\Scripts\Migration\Logs"
$LogFiles = Get-ChildItem $LogPath -Filter "*.log"

foreach ($LogFile in $LogFiles) {
    $Content = Get-Content $LogFile.FullName
    $Successful = ($Content | Select-String "–∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ").Count
    $Failed = ($Content | Select-String "–Ω–µ —É–¥–∞–ª–∞—Å—å").Count
    
    Write-Host "–§–∞–π–ª: $($LogFile.Name)"
    Write-Host "–£—Å–ø–µ—à–Ω–æ: $Successful, –ù–µ—É–¥–∞—á–Ω–æ: $Failed"
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤

```powershell
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏—è—Ö
$Report = @()
Get-MoveRequest | Get-MoveRequestStatistics | ForEach-Object {
    $Report += [PSCustomObject]@{
        User = $_.DisplayName
        Status = $_.Status
        PercentComplete = $_.PercentComplete
        SourceDB = $_.SourceDatabase
        TargetDB = $_.TargetDatabase
        CompletionTimestamp = $_.CompletionTimestamp
    }
}

$Report | Export-Csv "MigrationReport_$(Get-Date -Format 'yyyyMMdd').csv" -NoTypeInformation
```

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ Exchange Server 2016
- ‚úÖ Windows Server 2012 R2 / 2016 / 2019
- ‚úÖ PowerShell 5.0+
- ‚ö†Ô∏è Exchange Server 2013 (—Ç—Ä–µ–±—É–µ—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏–∏)
- ‚ùå Exchange Online (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –°–∫—Ä–∏–ø—Ç—ã —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–∞ Exchange Organization Management
- –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ Ctrl+C
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥-—Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ `Logs\`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Microsoft Exchange
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–ª—É–∂–±

## –õ–∏—Ü–µ–Ω–∑–∏—è

–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è "–∫–∞–∫ –µ—Å—Ç—å" –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.