# Exchange 2016 Database Defragmentation Script

**–Ø–∑—ã–∫–∏ / Languages:**
- [üá∑üá∫ –†—É—Å—Å–∫–∏–π](README.ru.md) ‚Üê (–¢–µ–∫—É—â–∏–π)
- [üá∫üá∏ English](README.md)

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PowerShell —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö Exchange Server 2016.

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Exchange Server 2016 —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–ª—É–∂–±. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤.

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** —Å–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- –î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ (‚â•110% –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–î)
- –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ –ø–∞–ø–∫—É:
   ```
   C:\Scripts\Defrag\ExchangeDefrag.ps1
   ```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞:
   ```powershell
   # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
   $DatabaseName = "Name-DB"

   # –ü—É—Ç—å –¥–ª—è –ª–æ–≥-—Ñ–∞–π–ª–∞
   $LogPath = "C:\Scripts\Defrag\Logs\DefragLog.txt"

   # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π (True/False)
   $Force = $True
   ```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Exchange Server 2016
- PowerShell 5.0 –∏–ª–∏ –≤—ã—à–µ
- –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Exchange
- –ü—Ä–∞–≤–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ ‚â•110% –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–î

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ë–î –ø–æ—Å–ª–µ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —Å–ª—É–∂–± Exchange
- ‚úÖ –î–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- ‚úÖ –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
- ‚úÖ –†–∞—Å—á–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- ‚úÖ –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```powershell
# –ó–∞–ø—É—Å–∫ –∏–∑ Exchange Management Shell
.\ExchangeDefrag.ps1
```

### –ó–∞–ø—É—Å–∫ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

```powershell
# –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å–∫—Ä–∏–ø—Ç–µ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
$DatabaseName = "MyDatabase"
$LogPath = "D:\Logs\DefragLog.txt"
$Force = $False  # –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Task Scheduler

```powershell
# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
$action = New-ScheduledTaskAction -Execute 'PowerShell.exe' -Argument '-ExecutionPolicy Bypass -File "C:\Scripts\Defrag\ExchangeDefrag.ps1"'
$trigger = New-ScheduledTaskTrigger -Weekly -DaysOfWeek Sunday -At 2:00AM
$settings = New-ScheduledTaskSettingsSet -RunOnlyIfNetworkAvailable -WakeToRun
Register-ScheduledTask -TaskName "Exchange DB Defrag" -Action $action -Trigger $trigger -Settings $settings -User "DOMAIN\ExchangeAdmin"
```

## –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**
   - –ó–∞–≥—Ä—É–∑–∫–∞ Exchange Management Shell
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –ª–æ–≥–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

2. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

3. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏**
   - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª—É–∂–± Exchange
   - –î–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

4. **–î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è**
   - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `eseutil /d`
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

5. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**
   - –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
   - –ó–∞–ø—É—Å–∫ —Å–ª—É–∂–± Exchange
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
   - –†–∞—Å—á–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

–õ–æ–≥-—Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ:

```
[2024-01-15 02:00:00] [INFO] ========== –ù–ê–ß–ê–õ–û –î–ï–§–†–ê–ì–ú–ï–ù–¢–ê–¶–ò–ò –ë–î EXCHANGE ==========
[2024-01-15 02:00:01] [INFO] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: MyDatabase
[2024-01-15 02:00:02] [INFO] –†–∞–∑–º–µ—Ä –ë–î –¥–æ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏: 25.5 GB
[2024-01-15 02:00:03] [SUCCESS] –°–ª—É–∂–±–∞ MSExchangeIS –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
[2024-01-15 02:00:04] [SUCCESS] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
[2024-01-15 02:00:05] [SUCCESS] –ù–∞—á–∞–ª–æ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏...
[2024-01-15 04:30:00] [SUCCESS] –î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞ 150.0 –º–∏–Ω—É—Ç
[2024-01-15 04:30:30] [SUCCESS] –†–∞–∑–º–µ—Ä –ë–î –ø–æ—Å–ª–µ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏: 18.2 GB
[2024-01-15 04:30:31] [SUCCESS] –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –º–µ—Å—Ç–∞: 7.3 GB (28.6%)
```

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

- **Exit Code 0**: –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- **Exit Code 1**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–ª–∏ –æ—Ç–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
Get-WmiObject -Class Win32_LogicalDisk | Select-Object DeviceID, @{Name="FreeSpace(GB)";Expression={[math]::Round($_.FreeSpace/1GB,2)}}

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
cleanmgr /sagerun:1

# –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ë–î –Ω–∞ –¥—Ä—É–≥–æ–π –¥–∏—Å–∫ (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
Move-DatabasePath -Identity "MyDatabase" -EdbFilePath "D:\Databases\MyDatabase.edb"
```

### –°–ª—É–∂–±—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

```powershell
# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–ª—É–∂–± Exchange
Start-Service MSExchangeIS
Start-Service MSExchangeRPC
Start-Service MSExchangeTransport

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–ª—É–∂–±
Get-Service | Where-Object {$_.Name -like "*Exchange*"} | Select-Object Name, Status
```

### –ë–î –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ë–î
eseutil /mh "C:\Database\MyDatabase.edb"

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ª–æ–≥–æ–≤ (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
eseutil /r E00 /l "C:\Database\Logs"

# –ñ–µ—Å—Ç–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ)
eseutil /p "C:\Database\MyDatabase.edb"
```

### –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```powershell
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
Get-StoreUsageStatistics -Database "MyDatabase" | Where-Object {$_.TimeInServer -gt 0}

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
Get-LogonStatistics -Database "MyDatabase" | Disable-MailboxImportRequest
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é**
   ```powershell
   # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —è—â–∏–∫–æ–≤ –≤ PST
   Get-Mailbox -Database "MyDatabase" | New-MailboxExportRequest -FilePath "\\BackupServer\Exports\{0}.pst"
   ```

2. **–£–≤–µ–¥–æ–º–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏
   - –£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—á—Ç—ã

3. **–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –≤—Ä–µ–º—è**
   - –í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏
   - –ù–µ—Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã
   - –ü–µ—Ä–∏–æ–¥—ã –Ω–∏–∑–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```powershell
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
# –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–∫—Ä–∏–ø—Ç –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ eseutil:
$defragProcess = Get-Process eseutil
$defragProcess.PriorityClass = "High"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```powershell
# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–∑–º–µ—Ä–∞ –ë–î
while ($true) {
    $size = (Get-Item "C:\Database\MyDatabase.edb").Length / 1GB
    Write-Host "–¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –ë–î: $([math]::Round($size, 2)) GB"
    Start-Sleep -Seconds 300  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
}
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

### –û–Ω–ª–∞–π–Ω-–¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è

```powershell
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–Ω–ª–∞–π–Ω-–¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è)
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö –ë–î –∏–ª–∏ —á–µ—Ä–µ–∑ PowerShell:
Set-MailboxDatabase -Identity "MyDatabase" -BackgroundDatabaseMaintenance $true
```

### –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —è—â–∏–∫–æ–≤

```powershell
# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤—Å–µ—Ö —è—â–∏–∫–æ–≤ –≤ –Ω–æ–≤—É—é –ë–î
New-MailboxDatabase -Name "NewDatabase" -EdbFilePath "D:\NewDB.edb"
Get-Mailbox -Database "MyDatabase" | New-MoveRequest -TargetDatabase "NewDatabase"
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥-—Ñ–∞–π–ª –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—à–∏–±–∫–∞—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Microsoft Exchange Server 2016

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ Exchange Server 2016
- ‚úÖ Windows Server 2012 R2 / 2016 / 2019
- ‚úÖ PowerShell 5.0+
- ‚ùå Exchange Online (Office 365)
- ‚ùå Exchange Server 2013 (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è)

## –õ–∏—Ü–µ–Ω–∑–∏—è

–°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è "–∫–∞–∫ –µ—Å—Ç—å" –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ.